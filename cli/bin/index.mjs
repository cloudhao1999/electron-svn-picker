#! /usr/bin/env node
import e from"shelljs";import t from"fs";import s from"path";import n from"inquirer";function r(e,r,o,i){const c={A:"新增",C:"冲突",D:"删除",I:"忽略",M:"修改",R:"替换",X:"未纳入版本控制的目录,被外部引用的目录所创建","!":"该项目已遗失(被非 svn 命令删除)或不完整","~":"版本控制下的项目与其它类型的项目重名"},p=[{type:"checkbox",name:"fileList",message:"请选择需要提交的项目",choices:e}];n.prompt(p).then((e=>{const n={},p={};e.fileList?.forEach((e=>{const t=c[e[0]],s=/\s/.test(t),r=e.indexOf(o),a=e.substring(r),f=e.substring(r).replace(o,i);!s&&f&&(n[t]?(n[t].push(f),p[t].push(a)):(n[t]=[f],p[t]=[a]))})),["","undefined"].forEach((e=>delete p[e])),["删除","忽略","","undefined"].forEach((e=>delete p[e]));const a=JSON.stringify(n,null,2).replace(/\\\\/g,"/").replace(/\\r/g,"");var f,l;f="record.json",l=a,t.writeFile(f,l,(e=>{if(e)throw e})),function(e,n,r,o){e.forEach((e=>{const i=(e=e.split("\r")[0]).split(r),c=s.resolve(process.cwd(),n+o+i[1]);t.existsSync(e)&&t.cp(e,c,{recursive:!0},(e=>{}))}))}(function(e){const t=[];for(const s in e)t.push(...e[s]);return t}(p),"./new/",r,i)}))}n.prompt([{type:"input",message:"请输入项目名称:",name:"projectName"},{type:"input",message:"请输入项目本地路径:",name:"fullPath"},{type:"input",message:"请输入项目SVN路径:",name:"svnPath"}]).then((t=>{t.projectName&&t.fullPath&&t.svnPath&&function(t,s,n){const o=e.exec(`svn status ${t}`,{silent:!0}).stdout.split("\n");Array.isArray(o)&&r(o,s,t,n)}(t.fullPath,t.projectName,t.svnPath)}));
